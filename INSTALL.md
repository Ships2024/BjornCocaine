## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

<p align="center">
  <img src="https://github.com/user-attachments/assets/c5eb4cc1-0c3d-497d-9422-1614651a84ab" alt="thumbnail_IMG_0546" width="98">
</p>

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#-–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
- [–ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#-–±—ã—Å—Ç—Ä–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#-—Ä—É—á–Ω–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–õ–∏—Ü–µ–Ω–∑–∏—è](#-–ª–∏—Ü–µ–Ω–∑–∏—è)

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Raspberry Pi Imager –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –≤–∞—à–µ–π –û–°
https://www.raspberrypi.com/software/

### üìå –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è RPI zero W (32-–±–∏—Ç)
![image](https://github.com/user-attachments/assets/3980ec5f-a8fc-4848-ab25-4356e0529639)

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ Raspberry Pi OS. 
    - –°—Ç–∞–±–∏–ª—å–Ω–∞—è:
      - –°–∏—Å—Ç–µ–º–∞: 32-–±–∏—Ç–Ω–∞—è
      - –í–µ—Ä—Å–∏—è —è–¥—Ä–∞: 6.6
      - –í–µ—Ä—Å–∏—è Debian: 12 (bookworm) '2024-10-22-raspios-bookworm-armhf-lite'
- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–º—è —Ö–æ—Å—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ `bjorn`.
- 2,13-–¥—é–π–º–æ–≤—ã–π e-Paper HAT –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –≤—ã–≤–æ–¥–∞–º GPIO.

### üìå –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è RPI zero W2 (64-–±–∏—Ç)

![image](https://github.com/user-attachments/assets/e8d276be-4cb2-474d-a74d-b5b6704d22f5)

–Ø –Ω–µ —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞–ª Bjorn –¥–ª—è raspberry pi zero w2 64-–±–∏—Ç, –Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–æ—à–ª–∞ —É—Å–ø–µ—à–Ω–æ.

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ Raspberry Pi OS. 
    - –°—Ç–∞–±–∏–ª—å–Ω–∞—è:
      - –°–∏—Å—Ç–µ–º–∞: 64-–±–∏—Ç–Ω–∞—è
      - –í–µ—Ä—Å–∏—è —è–¥—Ä–∞: 6.6
      - –í–µ—Ä—Å–∏—è Debian: 12 (bookworm) '2024-10-22-raspios-bookworm-arm64-lite'
- –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–º—è —Ö–æ—Å—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ `bjorn`.
- 2,13-–¥—é–π–º–æ–≤—ã–π e-Paper HAT –ø–æ–¥–∫–ª—é—á–µ–Ω –∫ –≤—ã–≤–æ–¥–∞–º GPIO.



–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —ç–∫—Ä–∞–Ω—ã e-Paper v2 –∏ v4.
–Ø –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ V1 –∏ V3 –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–∫ –∂–µ.
 
### ‚ö° –ë—ã—Å—Ç—Ä–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

–°–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π —Å–ø–æ—Å–æ–± —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Bjorn ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏:

```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫
wget https://raw.githubusercontent.com/infinition/Bjorn/refs/heads/main/install_bjorn.sh
sudo chmod +x install_bjorn.sh
sudo ./install_bjorn.sh
# –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç 1 –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏. –≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è, —Ç–∞–∫ –∫–∞–∫ –±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –º–Ω–æ–≥–æ –ø–∞–∫–µ—Ç–æ–≤ –∏ –º–æ–¥—É–ª–µ–π. –í –∫–æ–Ω—Ü–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è.
```

### üß∞ –†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞

#### –®–∞–≥ 1: –ê–∫—Ç–∏–≤–∏—Ä—É–π—Ç–µ SPI –∏ I2C

```bash
sudo raspi-config
```

- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –∫ **"Interface Options"**.
- –í–∫–ª—é—á–∏—Ç–µ **SPI**.
- –í–∫–ª—é—á–∏—Ç–µ **I2C**.

#### –®–∞–≥ 2: –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
# –û–±–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É
sudo apt-get update && sudo apt-get upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã

 sudo apt install -y \
  libjpeg-dev \
  zlib1g-dev \
  libpng-dev \
  python3-dev \
  libffi-dev \
  libssl-dev \
  libgpiod-dev \
  libi2c-dev \
  libatlas-base-dev \
  build-essential \
  python3-pip \
  wget \
  lsof \
  git \
  libopenjp2-7 \
  nmap \
  libopenblas-dev \
  bluez-tools \
  bluez \
  dhcpcd5 \
  bridge-utils \
  python3-pil


# –û–±–Ω–æ–≤–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ Nmap

sudo nmap --script-updatedb

```

#### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Bjorn

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Bjorn
cd /home/bjorn
git clone https://github.com/infinition/Bjorn.git
cd Bjorn

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
sudo pip install -r requirements.txt --break-system-packages
# –ü–æ—Å–∫–æ–ª—å–∫—É –º–Ω–µ "–ø–æ–∫–∞" –Ω–µ —É–¥–∞–ª–æ—Å—å –¥–æ–±–∏—Ç—å—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ–º, —è —É—Å—Ç–∞–Ω–æ–≤–∏–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ –º–∞—Å—à—Ç–∞–±–µ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã (—Å --break-system-packages), –¥–æ —Å–∏—Ö –ø–æ—Ä —ç—Ç–æ –Ω–µ –≤—ã–∑—ã–≤–∞–ª–æ –Ω–∏–∫–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏—Ö –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ.
```

##### 3.1: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ç–∏–ø –¥–∏—Å–ø–ª–µ—è E-Paper
–í—ã–±–µ—Ä–∏—Ç–µ –≤–µ—Ä—Å–∏—é –≤–∞—à–µ–≥–æ e-Paper HAT, –∏–∑–º–µ–Ω–∏–≤ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
```bash
sudo vi /home/bjorn/Bjorn/config/shared_config.json
```
–ù–∞–∂–º–∏—Ç–µ i, —á—Ç–æ–±—ã –≤–æ–π—Ç–∏ –≤ —Ä–µ–∂–∏–º –≤—Å—Ç–∞–≤–∫–∏
–ù–∞–π–¥–∏—Ç–µ —Å—Ç—Ä–æ–∫—É, —Å–æ–¥–µ—Ä–∂–∞—â—É—é "epd_type":
–ò–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –º–æ–¥–µ–ª—å—é –≤–∞—à–µ–≥–æ —ç–∫—Ä–∞–Ω–∞:

- –î–ª—è 2.13 V1: "epd_type": "epd2in13",
- –î–ª—è 2.13 V2: "epd_type": "epd2in13_V2",
- –î–ª—è 2.13 V3: "epd_type": "epd2in13_V3",
- –î–ª—è 2.13 V4: "epd_type": "epd2in13_V4",

–ù–∞–∂–º–∏—Ç–µ Esc, —á—Ç–æ–±—ã –≤—ã–π—Ç–∏ –∏–∑ —Ä–µ–∂–∏–º–∞ –≤—Å—Ç–∞–≤–∫–∏
–í–≤–µ–¥–∏—Ç–µ :wq –∏ –Ω–∞–∂–º–∏—Ç–µ Enter, —á—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –≤—ã–π—Ç–∏

#### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

–ß—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –æ—à–∏–±–∫—É `OSError: [Errno 24] Too many open files`, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–≤–µ–ª–∏—á–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤.

##### 4.1: –ò–∑–º–µ–Ω–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/etc/security/limits.conf`:

```bash
sudo vi /etc/security/limits.conf
```

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç—Ä–æ–∫–∏:

```
* soft nofile 65535
* hard nofile 65535
root soft nofile 65535
root hard nofile 65535
```

##### 4.2: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è Systemd

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/etc/systemd/system.conf`:

```bash
sudo vi /etc/systemd/system.conf
```

–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:

```
DefaultLimitNOFILE=65535
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/etc/systemd/user.conf`:

```bash
sudo vi /etc/systemd/user.conf
```

–†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –∏ –∏–∑–º–µ–Ω–∏—Ç–µ:

```
DefaultLimitNOFILE=65535
```

##### 4.3: –°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç–µ `/etc/security/limits.d/90-nofile.conf`

```bash
sudo vi /etc/security/limits.d/90-nofile.conf
```

–î–æ–±–∞–≤—å—Ç–µ:

```
root soft nofile 65535
root hard nofile 65535
```

##### 4.4: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–±—â–µ—Å–∏—Å—Ç–µ–º–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/etc/sysctl.conf`:

```bash
sudo vi /etc/sysctl.conf
```

–î–æ–±–∞–≤—å—Ç–µ:

```
fs.file-max = 2097152
```

–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```bash
sudo sysctl -p
```

#### –®–∞–≥ 5: –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ Systemd –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ systemd, —á—Ç–æ–±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤:

```bash
sudo systemctl daemon-reload
```

#### –®–∞–≥ 6: –ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ PAM

PAM (Pluggable Authentication Modules) —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–º, –∫–∞–∫ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ–∞–Ω—Å–æ–≤. –ß—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å–æ–±–ª—é–¥–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

##### –®–∞–≥ 6.1: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `/etc/pam.d/common-session` –∏ `/etc/pam.d/common-session-noninteractive`

```bash
sudo vi /etc/pam.d/common-session
sudo vi /etc/pam.d/common-session-noninteractive
```

–î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Å—Ç—Ä–æ–∫—É –≤ –∫–æ–Ω–µ—Ü –æ–±–æ–∏—Ö —Ñ–∞–π–ª–æ–≤:

```
session required pam_limits.so
```

–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤ `/etc/security/limits.conf`, –±—É–¥—É—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å–µ–∞–Ω—Å–æ–≤.

#### –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Å–ª—É–∂–±—ã

##### 7.1: –°–ª—É–∂–±–∞ Bjorn

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª —Å–ª—É–∂–±—ã:

```bash
sudo vi /etc/systemd/system/bjorn.service
```

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```ini
[Unit]
Description=Bjorn Service
DefaultDependencies=no
Before=basic.target
After=local-fs.target

[Service]
ExecStartPre=/home/bjorn/Bjorn/kill_port_8000.sh
ExecStart=/usr/bin/python3 /home/bjorn/Bjorn/Bjorn.py
WorkingDirectory=/home/bjorn/Bjorn
StandardOutput=inherit
StandardError=inherit
Restart=always
User=root

# –ü—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—Ç—å, –µ—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç (–±—É—Ñ–µ—Ä ulimit -n –∏–∑ 1000)
ExecStartPost=/bin/bash -c 'FILE_LIMIT=$(ulimit -n); THRESHOLD=$(( FILE_LIMIT - 1000 )); while :; do TOTAL_OPEN_FILES=$(lsof | wc -l); if [ "$TOTAL_OPEN_FILES" -ge "$THRESHOLD" ]; then echo "–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ø–æ—Ä–æ–≥ —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤: $TOTAL_OPEN_FILES (–ø–æ—Ä–æ–≥: $THRESHOLD). –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã."; systemctl restart bjorn.service; exit 0; fi; sleep 10; done &'

[Install]
WantedBy=multi-user.target
```



##### 7.2: –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–æ—Ä—Ç–∞ 8000

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –ø–æ—Ä—Ç–∞ 8000:

```bash
vi /home/bjorn/Bjorn/kill_port_8000.sh
```

–î–æ–±–∞–≤—å—Ç–µ:

```bash
#!/bin/bash
PORT=8000
PIDS=$(lsof -t -i:$PORT)

if [ -n "$PIDS" ]; then
    echo "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö –ø–æ—Ä—Ç $PORT: $PIDS"
    kill -9 $PIDS
fi
```

–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
chmod +x /home/bjorn/Bjorn/kill_port_8000.sh
```


##### 7.3: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è USB-–≥–∞–¥–∂–µ—Ç–∞

–ò–∑–º–µ–Ω–∏—Ç–µ `/boot/firmware/cmdline.txt`:

```bash
sudo vi /boot/firmware/cmdline.txt
```

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ `rootwait`:

```
modules-load=dwc2,g_ether
```

–ò–∑–º–µ–Ω–∏—Ç–µ `/boot/firmware/config.txt`:

```bash
sudo vi /boot/firmware/config.txt
```

–î–æ–±–∞–≤—å—Ç–µ –≤ –∫–æ–Ω–µ—Ü —Ñ–∞–π–ª–∞:

```
dtoverlay=dwc2
```

–°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç USB-–≥–∞–¥–∂–µ—Ç–∞:

```bash
sudo vi /usr/local/bin/usb-gadget.sh
```

–î–æ–±–∞–≤—å—Ç–µ —Å–ª–µ–¥—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```bash
#!/bin/bash
set -e

modprobe libcomposite
cd /sys/kernel/config/usb_gadget/
mkdir -p g1
cd g1

echo 0x1d6b > idVendor
echo 0x0104 > idProduct
echo 0x0100 > bcdDevice
echo 0x0200 > bcdUSB

mkdir -p strings/0x409
echo "fedcba9876543210" > strings/0x409/serialnumber
echo "Raspberry Pi" > strings/0x409/manufacturer
echo "Pi Zero USB" > strings/0x409/product

mkdir -p configs/c.1/strings/0x409
echo "Config 1: ECM network" > configs/c.1/strings/0x409/configuration
echo 250 > configs/c.1/MaxPower

mkdir -p functions/ecm.usb0

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏–º–≤–æ–ª–∏—á–µ—Å–∫–æ–π —Å—Å—ã–ª–∫–∏ –∏ —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
if [ -L configs/c.1/ecm.usb0 ]; then
    rm configs/c.1/ecm.usb0
fi
ln -s functions/ecm.usb0 configs/c.1/

# –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –∑–∞–Ω—è—Ç–æ, –ø—Ä–µ–∂–¥–µ —á–µ–º –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã USB-—É—Å—Ç—Ä–æ–π—Å—Ç–≤
max_retries=10
retry_count=0

while ! ls /sys/class/udc > UDC 2>/dev/null; do
    if [ $retry_count -ge $max_retries ]; then
        echo "–û—à–∏–±–∫–∞: –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏–ª–∏ —Ä–µ—Å—É—Ä—Å –∑–∞–Ω—è—Ç—ã –ø–æ—Å–ª–µ $max_retries –ø–æ–ø—ã—Ç–æ–∫."
        exit 1
    fi
    retry_count=$((retry_count + 1))
    sleep 1
done

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ª–∏ —É–∂–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å usb0
if ! ip addr show usb0 | grep -q "172.20.2.1"; then
    ifconfig usb0 172.20.2.1 netmask 255.255.255.0
else
    echo "–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å usb0 —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω."
fi
```

–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:

```bash
sudo chmod +x /usr/local/bin/usb-gadget.sh
```

–°–æ–∑–¥–∞–π—Ç–µ —Å–ª—É–∂–±—É systemd:

```bash
sudo vi /etc/systemd/system/usb-gadget.service
```

–î–æ–±–∞–≤—å—Ç–µ:

```ini
[Unit]
Description=USB Gadget Service
After=network.target

[Service]
ExecStartPre=/sbin/modprobe libcomposite
ExecStart=/usr/local/bin/usb-gadget.sh
Type=simple
RemainAfterExit=yes

[Install]
WantedBy=multi-user.target
```

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ `usb0`:

```bash
sudo vi /etc/network/interfaces
```

–î–æ–±–∞–≤—å—Ç–µ:

```bash
allow-hotplug usb0
iface usb0 inet static
    address 172.20.2.1
    netmask 255.255.255.0
```

–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ª—É–∂–±—ã:

```bash
sudo systemctl daemon-reload
sudo systemctl enable systemd-networkd
sudo systemctl enable usb-gadget
sudo systemctl start systemd-networkd
sudo systemctl start usb-gadget
```

–ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è, —á—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ USB-–≥–∞–¥–∂–µ—Ç (—Å IP-–∞–¥—Ä–µ—Å–æ–º).
###### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ü–ö —Å Windows

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP-–∞–¥—Ä–µ—Å –Ω–∞ –≤–∞—à–µ–º –ü–ö —Å Windows:

- **IP-–∞–¥—Ä–µ—Å**: `172.20.2.2`
- **–ú–∞—Å–∫–∞ –ø–æ–¥—Å–µ—Ç–∏**: `255.255.255.0`
- **–û—Å–Ω–æ–≤–Ω–æ–π —à–ª—é–∑**: `172.20.2.1`
- **DNS-—Å–µ—Ä–≤–µ—Ä—ã**: `8.8.8.8`, `8.8.4.4`

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

2024 - Bjorn —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ –ª–∏—Ü–µ–Ω–∑–∏–∏ MIT. –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —Å–º. —Ñ–∞–π–ª [LICENSE](LICENSE), –≤–∫–ª—é—á–µ–Ω–Ω—ã–π –≤ —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
